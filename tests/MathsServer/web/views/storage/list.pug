extends ../index.pug

block content

	script( type='text/javascript' src='/storage/list.js' )

	div( ng-controller='StorageList_Controller' )

		script
			!= `window.SERVER_DATA = {};\n`
			!= `window.SERVER_DATA.User = ${JSON.stringify( locals.User )};\n`
			!= `window.SERVER_DATA.ItemDefinition = ${JSON.stringify(locals.ItemDefinition)};\n`
			!= `window.SERVER_DATA.ServiceDefinition = ${JSON.stringify( locals.ServiceDefinition)};\n`
			!= `window.SERVER_DATA.Parameters = "${locals.Parameters}";\n`


		//-=====================================================================
		//-=====================================================================
		//- 
		//- 	Page Header
		//- 
		//-=====================================================================
		//-=====================================================================


		.w3-container.w3-blue-grey
			h2
				i
					span {{Page.Server.ItemDefinition.titles}}
					//- span( ng-show="Page.Server.PageFunction === 'ListAll'" ) All {{Page.Def.ServiceTitle}}
					//- span( ng-show="Page.Server.PageFunction === 'ListMine'" ) My {{Page.Def.ServiceTitle}}
					//- span( ng-show="Page.Server.PageFunction === 'DeleteMine'" ) Delete My {{Page.Def.ServiceTitle}}
					//- span( ng-show="Page.Server.PageFunction === 'DeleteAll'" ) Delete All {{Page.Def.ServiceTitle}}

		br

		.w3-container


			//-=====================================================================
			//-=====================================================================
			//- 
			//- 	Page Buttons
			//- 
			//-=====================================================================
			//-=====================================================================


			.w3-row
				//- a.w3-btn.w3-green.w3-border.w3-small.w3-padding-small(
				//- 	ng-click="Page.ListItems()"
				//- ) List {{ Page.Server.ItemDefinition.titles }}
				a.w3-btn.w3-green.w3-border.w3-small.w3-padding-small(
					ng-href="{{ Page.ItemCreateUrl() }}"
					ng-show="Page.ShowCreateButton()"
				) New {{ Page.Server.ItemDefinition.title }}
				//- a.w3-btn.w3-red.w3-border.w3-small.w3-padding-small(
				//- 	ng-click=""
				//- 	ng-show="Page.ShowDeleteButton()"
				//- ) Delete {{ Page.Server.ItemDefinition.title }}
				.w3-container.w3-margin


			//-=====================================================================
			//-=====================================================================
			//- 
			//- 	Page Items
			//- 
			//-=====================================================================
			//-=====================================================================


			.w3-row.w3-border.w3-round-large.w3-white

				table.w3-table
					tr 
						th.w3-rightbar.w3-padding-small.w3-center.no-line-break View Edit Delete
						th(
							ng-repeat="field in Page.Server.ItemDefinition.Fields"
						)
							span {{ field.title }}

					tr.w3-border(
						ng-repeat="item in Page.Items"
					)
						td.w3-rightbar.w3-padding-small.w3-center.no-line-break

							a.w3-btn.w3-sand.w3-border.w3-small.w3-padding-small(
								ng-href="{{Page.ItemViewUrl( item )}}" 
								ng-show="Page.UserCanDo('StorageFindOne')"
							)
								i.fa.fa-eye.w3-text-blue
							a.w3-btn.w3-sand.w3-border.w3-small.w3-padding-small(
								ng-href="{{Page.ItemEditUrl( item )}}" 
								ng-show="Page.UserCanDo('StorageWriteOne')"
							)
								i.fa.fa-edit.w3-text-green
							a.w3-btn.w3-sand.w3-border.w3-small.w3-padding-small(
								ng-href="{{Page.ItemDeleteUrl( item )}}" 
								ng-show="Page.UserCanDo('StorageDeleteOne')"
							)
								i.fa.fa-trash-alt.w3-text-red

						if( '|ListAll|DeleteAll|'.indexOf( locals.PageFunction ) > 0 )
							td {{ item.__info.owner_id }}

						td(
							ng-repeat="field in Page.Server.ItemDefinition.Fields"
						)
							span(
								ng-if="field.type === 'string'"
							) {{ item[ field.name ] }}

							span(
								ng-if="field.type === 'date'"
							) {{ item[ field.name ] }}

							span(
								ng-if="field.type === 'url'"
							)
								a(
									ng-show="item[ field.name ]"
									ng-href="{{ item[ field.name ] }}"
								) link

							span(
								ng-if="field.type === 'image_url'"
							)
								img(
									ng-src="{{item[ field.name ]}}"
									style="width:50px; height=auto;"
								)

							span(
								ng-if="field.type === 'number'"
							) {{ item[ field.name ] }}

							span(
								ng-if="field.type === 'array'"
							) {{ item[ field.name ].length }} items

							span(
								ng-if="field.type === 'object'"
							) {{ JSON.stringify( item[ field.name ] ) }}


			//-=====================================================================
			//-=====================================================================
			//- 
			//- 	Page Buttons
			//- 
			//-=====================================================================
			//-=====================================================================


			.w3-row
				.w3-container.w3-margin
				a.w3-btn.w3-green.w3-border.w3-small.w3-padding-small(
					ng-href="{{ Page.ItemCreateUrl() }}"
					ng-show="Page.ShowCreateButton()"
				) New {{ Page.Server.ItemDefinition.title }}
				//- a.w3-btn.w3-red.w3-border.w3-small.w3-padding-small(
				//- 	ng-click=""
				//- 	ng-show="Page.ShowDeleteButton()"
				//- ) Delete {{ Page.Server.ItemDefinition.title }}


